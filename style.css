:root{ --bg:#252525; --fg:#e5e7eb; --stage:#4A4A4A; --panel:#323232; --accent:#0b65c2; --timeline-layer-width:280px; --timeline-frame-width:24px; --timeline-row-height:32px; --timeline-toolbar-height:48px; --timeline-header-offset:calc(var(--timeline-row-height) + 12px); --timeline-grid-major:rgba(255,255,255,.08); --timeline-grid-minor:rgba(255,255,255,.04); --timeline-row-strip:#2d2d2d; --timeline-row-strip-alt:#292929; }
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif}
.hidden{display:none}
.err{position:fixed;left:0;right:0;top:0;background:#7f1d1d;color:#fee2e2;padding:10px;text-align:center;z-index:9999;border-bottom:1px solid #fecaca}

/* Top bar */
.bar{display:flex;align-items:center;background:#1f1f1f;border-bottom:1px solid #111;padding:6px 8px;gap:8px}
.left{display:flex;align-items:center;gap:6px}
.sym{font-size:14px;color:#cbd5e1}
.num{width:7ch;padding:6px 10px;background:#111;color:#fff;border:1px solid #333;border-radius:4px;text-align:center}
.btn,.icon-btn{padding:6px 10px;border:1px solid #3a3a3a;background:#262626;color:#fff;border-radius:4px;cursor:pointer}
.btn:hover,.icon-btn:hover{border-color:#fff;box-shadow:0 0 0 1px #fff inset}
.btn.flash,.icon-btn.flash{background:var(--accent)!important;border-color:var(--accent)!important;color:#fff!important;box-shadow:0 0 0 2px var(--accent) inset!important}
.zoom{min-width:54px;text-align:center;background:#0f172a;color:#fff;padding:6px 10px;border-radius:4px;border:1px solid #1e293b}
.icon-btn.on{background:var(--accent);border-color:var(--accent);color:#fff}
#stageColor{width:28px;height:28px;border:none;background:transparent;cursor:pointer}

/* Layout */
.layout{display:flex;height:calc(100vh - 44px);overflow:hidden}
.tools{width:64px;background:#323232;border-right:1px solid #1f1f1f;display:flex;flex-direction:column}
.tool-strip{display:flex;flex-direction:column;gap:6px;padding:6px;overflow:auto}
.tool-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:16px;border-radius:8px}
.tool-btn.selected{background:var(--accent)!important;border-color:var(--accent)!important;color:#fff!important;box-shadow:0 0 0 2px var(--accent) inset!important}

/* Work grid */
.work-grid{position:relative;display:grid;grid-template-columns:minmax(320px,1fr) 8px auto;grid-template-rows:100%;width:100%;height:100%}
.stage-pane{position:relative;min-width:200px;min-height:220px;overflow:hidden;background:transparent;touch-action:none}
#c{display:block;width:100%;height:100%;touch-action:none}
/* Visible by default; JS hides it after first draw */
.stage-dom{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:60%;height:60%;background:var(--stage);border:3px solid #fff;box-shadow:0 8px 18px rgba(0,0,0,.35);pointer-events:none;z-index:5}

/* Splitter & timeline */
.split{background:transparent;cursor:col-resize}
.timeline{background:var(--panel);min-width:0;display:flex;flex-direction:column;border-left:1px solid #1b1b1b;overflow:hidden}
.timeline-toolbar{display:flex;align-items:center;gap:12px;padding:6px 14px;background:linear-gradient(180deg,#343434 0%,#2a2a2a 100%);border-bottom:1px solid #1b1b1b;box-shadow:inset 0 -1px 0 rgba(0,0,0,.4);position:sticky;top:0;z-index:5}
.toolbar-group{display:flex;align-items:center;gap:6px}
.toolbar-separator{width:1px;height:28px;background:#1b1b1b;box-shadow:1px 0 0 rgba(255,255,255,.05)}
.tl-btn{padding:0 10px;min-width:32px;height:28px;border-radius:4px;border:1px solid #3a3a3a;background:#1f1f1f;color:#f8fafc;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 0 rgba(255,255,255,.04)}
.tl-btn.icon{font-size:15px}
.tl-btn:hover:not(:disabled){border-color:#60a5fa;box-shadow:0 0 0 1px #60a5fa inset}
.tl-btn:disabled{opacity:.4;cursor:not-allowed;border-color:#2f2f2f;box-shadow:none}
.timeline-status{margin-left:auto;font-size:12px;color:#cbd5e1;text-shadow:0 1px 0 rgba(0,0,0,.6)}
.timeline-main{display:flex;flex-direction:column;flex:1;overflow:hidden}
.timeline-header{display:grid;grid-template-columns:var(--timeline-layer-width) 1fr;background:#262626;border-bottom:1px solid #1b1b1b;position:sticky;top:var(--timeline-toolbar-height);z-index:4;min-height:var(--timeline-row-height);align-items:center}
.layer-header{display:grid;grid-template-columns:32px 64px 1fr 20px;align-items:center;column-gap:10px;padding:0 10px;font-size:11px;color:#d1d5db;letter-spacing:.08em;text-transform:uppercase;background:#2f2f2f;border-right:1px solid #1b1b1b;height:100%;text-shadow:0 1px 0 rgba(0,0,0,.6)}
.layer-header .header-index{display:flex;align-items:center;justify-content:center;font-variant-numeric:tabular-nums;gap:4px}
.layer-header .header-index::before{content:'▤';font-size:11px;color:#9ca3af}
.layer-header .header-controls{display:flex;align-items:center;gap:6px;font-size:13px;opacity:.75}
.layer-header .header-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.layer-header .header-chip{height:12px;width:12px;border-radius:2px;background:linear-gradient(135deg,#4f46e5 0%,#93c5fd 100%);box-shadow:0 0 0 1px rgba(0,0,0,.45)}
.frames-header{position:relative;display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--timeline-frame-width),1fr));min-height:var(--timeline-row-height);align-items:flex-end;font-size:11px;color:#cbd5e1;user-select:none;padding:6px 0 4px;background:linear-gradient(180deg,#2e2e2e 0%,#262626 100%);border-left:1px solid #1f1f1f}
.frames-header::before{content:"";position:absolute;inset:0;background:repeating-linear-gradient(90deg, var(--timeline-grid-minor) 0, var(--timeline-grid-minor) 1px, transparent 1px, transparent calc(var(--timeline-frame-width)), transparent calc(var(--timeline-frame-width)), transparent calc(var(--timeline-frame-width) * 5 - 1px), var(--timeline-grid-major) calc(var(--timeline-frame-width) * 5 - 1px), var(--timeline-grid-major) calc(var(--timeline-frame-width) * 5));pointer-events:none}
.frames-header .frame-number{position:relative;display:flex;align-items:flex-end;justify-content:center;border-right:1px solid rgba(0,0,0,.65);padding:2px 0;background:transparent}
.frames-header .frame-number.major{font-weight:600;color:#f1f5f9;text-shadow:0 1px 0 rgba(0,0,0,.7)}
.timeline-body{flex:1;overflow:auto;background:#202020;padding-top:var(--timeline-header-offset);scroll-padding-top:var(--timeline-header-offset)}
.timeline-content{display:grid;grid-template-columns:var(--timeline-layer-width) auto;min-width:100%;min-height:100%}
.layer-list{background:#2f2f2f;border-right:1px solid #1b1b1b;position:sticky;left:0;z-index:3;display:flex;flex-direction:column}
.layer-row{--layer-color:var(--accent);display:grid;grid-template-columns:32px 64px 1fr 20px;align-items:center;column-gap:10px;padding:0 10px;height:var(--timeline-row-height);border-bottom:1px solid #1f1f1f;cursor:pointer;user-select:none;background:var(--timeline-row-strip)}
.layer-row:hover:not(.selected){background:#333}
.layer-row:nth-child(even){background:var(--timeline-row-strip-alt)}
.layer-row .layer-index{font-size:11px;color:#9ca3af;display:flex;align-items:center;justify-content:center;gap:4px;font-variant-numeric:tabular-nums}
.layer-row .layer-index::before{content:'▤';font-size:11px;color:#6b7280}
.layer-row .layer-controls{display:flex;align-items:center;gap:6px;justify-content:center}
.layer-row .layer-toggle{width:26px;height:22px;border-radius:4px;border:1px solid #3a3a3a;background:#1f1f1f;color:#e5e7eb;font-size:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 1px 0 rgba(255,255,255,.03)}
.layer-row .layer-toggle:hover{border-color:#f8fafc}
.layer-row .layer-toggle.on{background:var(--accent);border-color:var(--accent);color:#fff}
.layer-row.selected{background:#1a2f46;box-shadow:inset 0 0 0 1px rgba(96,165,250,.35),inset 4px 0 0 var(--layer-color)}
.layer-row.selected .layer-name{color:#e0f2fe}
.layer-row.selected .layer-toggle{border-color:#94c0ff}
.layer-row.selected .layer-chip{box-shadow:0 0 0 1px rgba(255,255,255,.5),0 0 0 2px rgba(0,0,0,.4)}
.layer-row.locked .layer-name{color:#94a3b8}
.layer-row.hidden .layer-name{color:#64748b;font-style:italic}
.layer-row.hidden .layer-toggle{opacity:.7}
.layer-row.hidden .layer-chip{opacity:.6}
.layer-row .layer-name{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.layer-row .layer-chip{width:12px;height:12px;border-radius:2px;box-shadow:0 0 0 1px rgba(0,0,0,.45),0 0 0 2px rgba(255,255,255,.05);justify-self:flex-end;background:var(--layer-color)}
.frames-list{position:relative;display:flex;flex-direction:column;background:#202020}
.frame-row{--layer-color:var(--accent);display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--timeline-frame-width),1fr));height:var(--timeline-row-height);border-bottom:1px solid #1b1b1b;position:relative;background:repeating-linear-gradient(90deg, rgba(255,255,255,.04) 0, rgba(255,255,255,.04) 1px, transparent 1px, transparent calc(var(--timeline-frame-width)));}
.frame-row.selected::after{content:"";position:absolute;inset:0;box-shadow:inset 0 0 0 1px rgba(96,165,250,.25),inset 4px 0 0 var(--layer-color);pointer-events:none}
.frame-row::before{content:"";position:absolute;inset:0;background:repeating-linear-gradient(90deg, var(--timeline-grid-minor) 0, var(--timeline-grid-minor) 1px, transparent 1px, transparent calc(var(--timeline-frame-width)), transparent calc(var(--timeline-frame-width)), transparent calc(var(--timeline-frame-width) * 5 - 1px), var(--timeline-grid-major) calc(var(--timeline-frame-width) * 5 - 1px), var(--timeline-grid-major) calc(var(--timeline-frame-width) * 5));pointer-events:none}
.frame-row > *{position:relative}
.frame-cell{border-right:1px solid rgba(0,0,0,.65);background:rgba(45,45,45,.95);position:relative;cursor:pointer}
.frame-cell.blank{background:rgba(38,38,38,.85)}
.frame-cell.keyframe::after{content:"";position:absolute;width:10px;height:10px;border-radius:50%;background:#f8fafc;border:2px solid #111;box-shadow:0 0 0 1px rgba(255,255,255,.2);left:50%;top:50%;transform:translate(-50%,-50%)}
.frame-cell.selected{outline:2px solid var(--accent);outline-offset:-2px;z-index:2}
.frame-cell.range{background:linear-gradient(90deg, rgba(59,130,246,.3) 0%, rgba(59,130,246,.05) 100%)}
.frame-cell.locked{background:#1e293b}
.frame-cell.hidden{background:#1f2937}
.timeline-empty{padding:12px 10px;color:#9ca3af;font-size:13px}

/* Guide labels & popover */
.guide-label{position:absolute;transform:translate(-50%,-50%);background:#0f172a;color:#fff;border:1px solid #1e293b;padding:2px 6px;border-radius:999px;font-size:11px;pointer-events:none;z-index:20}
.popover{position:absolute;width:260px;padding:8px;border-radius:8px;background:#111827;border:1px solid var(--accent);color:#e2e8f0;z-index:30;box-shadow:0 8px 18px rgba(0,0,0,.45)}
.popover .row{display:flex;gap:8px;align-items:center;margin:6px 0}
.popover .sw{width:24px;height:24px;border-radius:4px;border:2px solid transparent;cursor:pointer}
.popover .sw.selected{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.5)}
.value-only.text{width:90px;padding:6px 8px;background:#0f172a;color:#e5e7eb;border:1px solid #1e293b;border-radius:6px}

body{overscroll-behavior:contain}
